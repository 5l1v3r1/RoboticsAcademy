<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.5 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Visual follow-line - Robotics-Academy</title>
<meta name="description" content="Following the line painted on the racing circuit.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Robotics-Academy">
<meta property="og:title" content="Visual follow-line">
<meta property="og:url" content="http://localhost:4000/portfolio/follow_line/">


  <meta property="og:description" content="Following the line painted on the racing circuit.">



  <meta property="og:image" content="http://localhost:4000/assets/images/exercises/follow_line/formula1.png">





  <meta property="article:published_time" content="2019-11-17T09:18:46+05:30">





  

  


<link rel="canonical" href="http://localhost:4000/portfolio/follow_line/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "JdeRobot",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Robotics-Academy Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="icon" type="image/png" href="/assets/images/logo.png" sizes="16x16">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Robotics-Academy
          <span class="site-subtitle">Powered by JdeRobot</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/exercises/" >Exercises</a>
            </li><li class="masthead__menu-item">
              <a href="/installation/" >Installation and use</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero"
  style=" "
>
  
    <img src="/assets/images/exercises/follow_line/formula1.png" alt="Visual follow-line" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  

  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Visual follow-line">
    <meta itemprop="description" content="Following the line painted on the racing circuit.">
    <meta itemprop="datePublished" content="November 17, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Visual follow-line
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h2 id="objective">Objective</h2>

<p>The objective of this practice is to perform a PID reactive control capable of following the line painted on the racing circuit.</p>

<figure class="third ">
  
    
      <a href="/assets/images/exercises/follow_line/formula1_circuit.png" title="Racing circuit.">
        <img src="/assets/images/exercises/follow_line/formula1_circuit.png" alt="Racing circuit." />
      </a>
    
  
    
      <a href="/assets/images/exercises/follow_line/formula1.png" title="First Person.">
        <img src="/assets/images/exercises/follow_line/formula1.png" alt="First Person." />
      </a>
    
  
    
      <a href="/assets/images/exercises/follow_line/formula1_2.png" title="Model.">
        <img src="/assets/images/exercises/follow_line/formula1_2.png" alt="Model." />
      </a>
    
  
  
    <figcaption>Gallery
</figcaption>
  
</figure>

<p>The students program a Formula1 car in a race circuit to follow the red line in the middle of the road.</p>

<h2 id="how-to-execute">How to execute?</h2>
<p>To launch the infrastructure of this practice, first set up the gazebo sources, then launch the simulator with the appropriate scenario:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> /opt/jderobot/share/jderobot/gazebo/gazebo-setup.sh
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> /opt/jderobot/share/jderobot/gazebo/gazebo-assets-setup.sh
</code></pre></div></div>

<p>or add them directly to your bashrc to run automatically whenever you open a terminal:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'source /opt/jderobot/share/jderobot/gazebo/gazebo-setup.sh'</span> <span class="o">&gt;</span> ~/.bashrc
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'source /opt/jderobot/share/jderobot/gazebo/gazebo-assets-setup.sh'</span> <span class="o">&gt;</span> ~/.bashrc
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">source</span> ~/.bashrc
</code></pre></div></div>

<p>Navigate to the follow_line directory</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>exercises/follow_line
</code></pre></div></div>

<p>Launch Gazebo with the f1_simple_circuit world through the command</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>roslaunch ./launch/simple_line_follower_ros.launch
</code></pre></div></div>

<p>Then you have to execute the academic application, which will incorporate your code:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python2 ./follow_line.py follow_line_conf.yml
</code></pre></div></div>

<h2 id="how-to-do-the-practice">How to do the practice?</h2>
<p>To carry out the practice, you have to edit the file <code class="highlighter-rouge">MyAlgorithms.py</code> and insert in it your code, which gives intelligence to the autonomous car.</p>

<h2 id="where-to-insert-the-code">Where to insert the code?</h2>
<p>In the <code class="highlighter-rouge">MyAlgorithm.py</code> file,</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#GETTING THE IMAGES
</span>        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getImage</span><span class="p">()</span>

        <span class="c1"># Add your code here
</span>        <span class="k">print</span> <span class="s">"Runing"</span>

        <span class="c1">#EXAMPLE OF HOW TO SEND INFORMATION TO THE ROBOT ACTUATORS
</span>        <span class="c1">#self.motors.sendV(10)
</span>        <span class="c1">#self.motors.sendW(5)
</span>
        <span class="c1">#SHOW THE FILTERED IMAGE ON THE GUI
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">set_threshold_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="api">API</h3>
<ul>
  <li><code class="highlighter-rouge">self.getImage()</code> - to get the image</li>
  <li><code class="highlighter-rouge">self.motors.sendV()</code> - to set the linear speed</li>
  <li><code class="highlighter-rouge">self.motors.sendW()</code> - to set the angular velocity</li>
  <li><code class="highlighter-rouge">self.set_threshold_image()</code> - allows you to view a debug image or with relevant information. It must be an image in RGB format (Tip: np.dstack())</li>
</ul>

<h2 id="theory">Theory</h2>
<p>PID Control is the main fundamental behind this exercise. To understand PID Control, let us first understand what is Control in general.</p>

<h3 id="control-system">Control System</h3>
<p>A system of devices or set of devices, that manages, commands, directs or regulates the behavior of other devices or systems to achieve the desired results. Simply speaking, a system which controls other systems. Control Systems help a robot to execute a set of commands precisely, in the presence of unforseen errors.</p>

<p><img src="http://localhost:4000/assets/images/exercises/follow_line/ControlSystems.jpg" alt="Control System" /></p>

<h3 id="types-of-control-system">Types of Control System</h3>
<h4 id="open-loop-control-system">Open Loop Control System</h4>
<p>A control system in which the control action is completley independent of the output of the system. A manual control system is on Open Loop System.</p>

<h4 id="closed-loop-control-system">Closed Loop Control System</h4>
<p>A control system in which the ouput has an effect on the input quantity in such a manner that the input will adjust itself based on the output generated. An open loop system can be converted to a closed one by providing a feedback.</p>

<p><img src="http://localhost:4000/assets/images/exercises/follow_line/TypesofControlSystems.jpg" alt="Types of Control Systems" /></p>

<h3 id="pid-control">PID Control</h3>
<p>A control loop mechanism employing feedback. A PID Controller continously calculates an error value as the difference between desired output and the current output and applies a correction based on proporional, integral and derivative terms(denoted by P, I, D respectively).</p>

<h4 id="proportional">Proportional</h4>
<p>Proportional Controller gives an output which is proportional to the current error. The error is multiplied with a proportionality constant to get the output. And hence, is 0 if the error is 0.</p>
<h4 id="integral">Integral</h4>
<p>Integral Controller provides a necessary action to eliminate the offset error which is accumalted by the P Controller.It integrates the error over a period of time until the error value reaches to zero.</p>
<h4 id="derivative">Derivative</h4>
<p>Derivative Controller gives an output depending upon the rate of change or error with respect to time. It gives the kick start for the output thereby increasing system response.</p>

<p><img src="http://localhost:4000/assets/images/exercises/follow_line/PID.png" alt="PID Control Equation" /></p>

<h3 id="tuning-methods">Tuning Methods</h3>
<p>In order for the PID equation to work, we need to determine the constants of the equation. There are 3 constants called the gains of the equation. We have 2 main tuning methods for this.</p>

<h4 id="trial-and-error">Trial and Error</h4>
<p>It is a simple method of PID controller tuning. While system or controller is working, we can tune the controller. In this method, first we have to set Ki and Kd values to zero and increase proportional term (Kp) until system reaches to oscillating behavior. Once it is oscillating, adjust Ki (Integral term) so that oscillations stops and finally adjust D to get fast response.</p>

<h4 id="zeigler-nichols-method">Zeigler Nichols method</h4>
<p>Zeigler-Nichols proposed closed loop methods for tuning the PID controller. Those are continuous cycling method and damped oscillation method. Procedures for both methods are same but oscillation behavior is different. In this, first we have to set the p-controller constant, Kp to a particular value while Ki and Kd values are zero. Proportional gain is increased till system oscillates at constant amplitude.</p>

<h3 id="real-life-example">Real Life Example</h3>

<p><a href="https://accautomation.ca/tag/pid-control-car-analogy/">1</a>
<a href="https://www.youtube.com/watch?v=UR0hOmjaHp0">2</a></p>

<h2 id="hints">Hints</h2>
<p>Simple hints provided to help you solve the follow_line exercise.</p>

<h3 id="detecting-the-line-to-follow">Detecting the Line to Follow</h3>
<p>The first task of the assignment is to detect the line to be followed. This can be achieved easily by <strong>filtering the color of the line</strong> from the image and applying basic image processing to find the point or line to follow, or in Control terms our <em>Set Point</em>. Refer to these links for more information:</p>

<p><a href="https://www.pyimagesearch.com/2014/08/04/opencv-python-color-detection/">1</a>
<a href="https://stackoverflow.com/questions/10469235/opencv-apply-mask-to-a-color-image">2</a>
<a href="https://stackoverflow.com/questions/22470902/understanding-moments-function-in-opencv">3</a></p>

<h3 id="coding-the-controller">Coding the Controller</h3>
<p>The Controller can be designed in various configurations. 3 configurations have been descirbed in detail below:</p>

<h4 id="p-controller">P Controller</h4>
<p>The simplest way to do the assignment is using the P Controller. Just find the error which is the difference between our <em>Set Point</em> (The point where our car should be heading) and the <em>Current Output</em> (Where the car is actually heading). Keep adjusting the value of the constant, till we get a value where there occurs no <a href="#Illustrations"><strong>unstable oscillations</strong></a> and no <a href="#Illustrations"><strong>slow response</strong></a>.</p>

<h4 id="pd-controller">PD Controller</h4>
<p>This is an intersting way to see the effect of Derivative on the Control. For this, we need to calculate the derivative of the output we are receiving. Since, we are dealing with <em>discrete outputs in our case, we simply calculate the difference between our previous error and the present error</em>, then adjust the proportional constant. Adjust this value along with the P gain to get a good result.</p>

<h4 id="pid-controller">PID Controller</h4>
<p>This is the complete implemented controller. Now, to add the I Controller we need to integrate the output from the point where error was zero, to the present output. While dealing with discrete outputs, we can acheive this using <em>accumalated error</em>. Then, comes the task of adjustment of gain constants till we get our desired result.</p>

<h3 id="illustrations">Illustrations</h3>
<p><img src="http://localhost:4000/assets/images/exercises/follow_line/oscillations.gif" alt="Unstable Oscillations" /></p>

<p><em>Unstable Oscillations</em></p>

<p><img src="http://localhost:4000/assets/images/exercises/follow_line/slowresponse.gif" alt="Slow Response" /></p>

<p><em>Slow Response</em></p>

<h2 id="demonstrative-video">Demonstrative Video</h2>

<div class="embed-container">
  <iframe src="https://www.youtube.com/embed/eNuSQN9egpA" width="700" height="480" frameborder="0" allowfullscreen="">
  </iframe>
</div>

<h2 id="references">References</h2>

<p><a href="https://www.electrical4u.com/control-system-closed-loop-open-loop-control-system/">1</a>
<a href="https://en.wikipedia.org/wiki/PID_controller">2</a>
<a href="https://www.elprocus.com/the-working-of-a-pid-controller/">3</a>
<a href="https://www.tutorialspoint.com/control_systems/control_systems_introduction.htm">4</a>
<a href="https://instrumentationtools.com/open-loop-and-closed-animation-loop/">5</a>
<a href="https://trinirobotics.com/2019/03/26/arduino-uno-robotics-part-2-pid-control/">6</a>
<a href="http://homepages.math.uic.edu/~kauffman/DCalc.pdf">7</a></p>


        
      </section>

      <footer class="page__meta">
        
        


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-11-17T09:18:46+05:30">November 17, 2019</time></p>
        
      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=Visual+follow-line%20http%3A%2F%2Flocalhost%3A4000%2Fportfolio%2Ffollow_line%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fportfolio%2Ffollow_line%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fportfolio%2Ffollow_line%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/portfolio/follow_face/" class="pagination--pager" title="Follow Face
">Previous</a>
    
    
      <a href="/portfolio/global_navigation/" class="pagination--pager" title="Global navigation of a TeleTaxi
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/unibotics" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/JdeRobot/RoboticsAcademy" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
          <li><a href="https://www.youtube.com/channel/UCS9IvIytJNqQqImT99g-d6g" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i> Youtube</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 JdeRobot. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>
  <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML">
  </script>
  <script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       extensions: ["tex2jax.js"],
       jax: ["input/TeX", "output/HTML-CSS"],
       tex2jax: {
         inlineMath: [ ['$','$'], ["\\(","\\)"] ],
         displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
         processEscapes: true
       },
       "HTML-CSS": { availableFonts: ["TeX"] }
     });
  </script>










  </body>
</html>
